apiVersion: skaffold/v4beta1
kind: Config

profiles:
  - name: dev
    build:
      local:
        push: true    
      artifacts:
        - image: saturn203/simple-api
          jib:
            args:
              - -DskipTests
              - "-Djib.container.environment=SPRING_PROFILES_ACTIVE=dev"
            fromImage: eclipse-temurin:17.0.2_8-jre
    deploy:
     
      helm:       
        releases:
          - name: simple-api
            namespace: api
            chartPath: ./charts/simple-api         
            
            setValues:    
              ingress.enabled: true
              ingress.hosts[0].host: simple-api.192.168.41.8.sslip.io
              ingress.hosts[0].paths[0].path: /
              ingress.hosts[0].paths[0].pathType: Prefix
        flags:
          upgrade:
            - --install


    portForward:
    - resourceType: deployment
      resourceName: simple-api-deploy
      namespace: api
      port: 8080
      localPort: 9320 # *Optional*          